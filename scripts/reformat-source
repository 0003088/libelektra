#!/bin/sh
#
# @author Markus Raab <elektra@markus-raab.org>
# @brief Reformats the whole source code
# @date 18.02.2016
# @tags reformat

SCRIPTS_DIR=$(dirname "$0")
. "${SCRIPTS_DIR}/include-common"

CLANG_FORMAT=$(which clang-format-6.0 || which clang-format)

if [ -n "${CLANG_FORMAT}" ]; then
	version=$("${CLANG_FORMAT}" --version 2> /dev/null | sed -E 's/.* ([6-9]+)\.[0-9].[0-9] .*/\1/')
	[ "$version" -ge 6 ] || unset CLANG_FORMAT
fi

if [ -z "${CLANG_FORMAT}" ]; then
	echo "Please install clang-format 6, or 7"
	exit 0
fi

cd "$SOURCE"

$($CLANG_FORMAT -style=file -i $(find . -name '*.[ch]' -or -name '*.[ch]pp' -or -name '*.[ch].in' | egrep -v "^./src/tools/gen"))
